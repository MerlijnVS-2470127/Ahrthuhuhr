<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/FS_Standard_Head'); %>
    <title>Home - Fellowships</title>
    <script type="module" src="/js/FS_Home.js"></script>
    <script>
      window.username = "<%= username %>";
    </script>
  </head>

  <header><%- include('../partials/FS_Header'); %></header>

  <div class="main-content-wrapper">
    <body>
      <div class="main_div">
        <div class="page_header">Home</div>

        <hr />

        <div class="main_tab">
          <h1 id="Homepage_Groups_h1">
            <a href="/groups" class="tab_header"> Groups </a>
          </h1>
          <% if (Array.isArray(groups) && groups.length) { let iteration = 0; %>
          <% groups.forEach(function(gr) { if(iteration < 3){ %>
          <div class="card">
            <div class="card-header list-group-header">
              <h1 class="card-title text-primary"><%= gr.name %></h1>
            </div>
            <div class="card-body"><%= gr.description %></div>

            <div class="card-footer">
              <button
                class="group-button btn btn-primary"
                type="button"
                id="<%= gr.id %> "
              >
                Open chat
              </button>
            </div>
          </div>
          <% iteration += 1 }})} else { %>
          <div>
            When you join a group, they wil be displayed here.<br />You can also
            create one yourself!
          </div>
          <% } %>
        </div>

        <hr />

        <div class="main_tab">
          <h1><a href="/events" class="tab_header"> Events </a></h1>
          <% if (Array.isArray(events) && events.length) { let iteration = 0; %>
          <div id="eventsGridWrapper">
            <div id="eventsGrid" class="events-grid">
              <% events.forEach(function(ev) { if(iteration < 3){ %> <% let
              statusClass = (ev.status || 'planned').replace(/\s+/g,
              '-').toLowerCase(); %>
              <div class="card" style="padding: 20px; margin-bottom: 10px">
                <article
                  class="event-tile"
                  role="article"
                  aria-labelledby="ev-<%= ev.id %>-title"
                  data-status="<%= ev.status %>"
                  data-group-id="<%= ev.group_id %>"
                >
                  <div class="event-content">
                    <h3
                      id="ev-<%= ev.id %>-title"
                      class="event-title status-<%= statusClass %>"
                      title="<%= ev.title %>"
                    >
                      <%= ev.title %>
                    </h3>

                    <!-- Group name above date -->
                    <div class="mb-1">
                      <small
                        class="badge bg-light text-muted"
                        title="<%= ev.group_name || '' %>"
                      >
                        <a
                          href="/groups/<%= ev.group_id %>"
                          class="bg-light text-muted"
                          style="font-size: 0.75rem; text-decoration: none"
                          ><%= ev.group_name_abbrev || ev.group_name || '—' %>
                        </a>
                      </small>
                    </div>

                    <div class="event-date" aria-hidden="true">
                      <%= ev.start %> <% if (ev.end) { %> — <%= ev.end %> <% }
                      %>
                    </div>

                    <div class="event-location-block">
                      <span class="visually-hidden">Location: </span>
                      <% if (ev.lat && ev.lng) { %>
                      <a
                        href="#map"
                        class="event-location"
                        data-lat="<%= ev.lat %>"
                        data-lng="<%= ev.lng %>"
                        data-label="<%= ev.location %>"
                      >
                        <%= ev.location %>
                      </a>
                      <% } else { %>
                      <span class="event-location-text"
                        ><%= ev.location %></span
                      >
                      <% } %>
                    </div>

                    <% if (ev.description) { %>
                    <p class="event-description"><%= ev.description %></p>
                    <% } %>

                    <div class="event-actions">
                      <a
                        href="/events/<%= ev.id %>"
                        class="btn btn-primary event-button"
                        role="button"
                        title="View event: <%= ev.title %>"
                        aria-label="View event <%= ev.title %>"
                      >
                        View event
                      </a>
                    </div>
                  </div>
                </article>
              </div>
              <%iteration += 1; }}) %>
            </div>

            <p id="noMatchMsg" style="display: none">
              No events match your filters.
            </p>
          </div>
          <% } else { %>
          <p id="noEventsServer">No events found.</p>
          <% } %>
        </div>
      </div>
    </body>
  </div>

  <footer><%- include('../partials/FS_Footer'); %></footer>
</html>
